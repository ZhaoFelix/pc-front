(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-70c30648"],{"1f47":function(e,t,r){"use strict";r.r(t);var i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"app-container"},[r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticStyle:{"margin-top":"10px",width:"100%"},attrs:{data:e.list,"element-loading-text":"Loading",border:"",fit:"","highlight-current-row":""}},[r("el-table-column",{attrs:{label:"订单号",align:"center","min-width":"190",fixed:""},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",[e._v(e._s(t.row.order_number))])]}}])}),r("el-table-column",{attrs:{label:"微信昵称",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",[e._v(" "+e._s(t.row.wechat_nickname)+" ")])]}}])}),r("el-table-column",{attrs:{label:"用户手机号",align:"center","min-width":"110"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",[e._v(" "+e._s(t.row.user_phone)+" ")])]}}])}),r("el-table-column",{attrs:{label:"用户地址",align:"center",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",[e._v(" "+e._s(t.row.user_address)+" ")])]}}])}),r("el-table-column",{attrs:{label:"渣土面积",align:"center","min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",[e._v(" "+e._s(t.row.order_size+" m²")+" ")])]}}])}),r("el-table-column",{attrs:{label:"渣土图片",align:"center","min-width":"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("viewer",{attrs:{images:[t.row.wechat_avatar]}},e._l(JSON.parse(t.row.user_place_order_img),(function(e,t){return r("el-image",{key:t,staticClass:"image-thumb",attrs:{src:e.url,fit:"cover"}})})),1)]}}])}),r("el-table-column",{attrs:{label:"用户预约时间",align:"center","min-width":"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",{staticStyle:{color:"red"}},[e._v(" "+e._s(e._f("parseTime")(t.row.user_reserve_time,"{y}-{m}-{d} {h}:{i}"))+" ")])]}}])}),r("el-table-column",{attrs:{label:"装修类型",align:"center","min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-tag",{attrs:{type:0==t.row.order_type?"success":"danger"}},[e._v(e._s(0==t.row.order_type?"普通装修":"商业装修"))])]}}])}),r("el-table-column",{attrs:{label:"指定清运点",align:"center","min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-tag",{attrs:{type:1==t.row.order_is_assign?"success":"danger"}},[e._v(e._s(1==t.row.order_is_assign?"是":"否"))])]}}])}),r("el-table-column",{attrs:{label:"订单价格",align:"center","min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",{staticStyle:{color:"red"}},[e._v(e._s(null==t.row.order_price?"待确定":"￥ "+t.row.order_price.toFixed(2)))])]}}])}),r("el-table-column",{attrs:{label:"支付价格",align:"center","min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",{staticStyle:{color:"red"}},[e._v(e._s("￥"+(t.row.order_final_price+t.row.second_pay_price)))])]}}])}),r("el-table-column",{attrs:{label:"订单状态",align:"center",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[0==t.row.order_status?r("el-tag",{attrs:{type:"danger"}},[e._v(" "+e._s(null==t.row.order_price?"待定价":"待支付")+" ")]):e._e(),7==t.row.order_status?r("el-tag",{attrs:{type:"danger"}},[e._v(" 待补差价 ")]):e._e(),1==t.row.order_status?r("el-tag",{attrs:{type:"success"}},[e._v("已支付待派单")]):e._e(),2==t.row.order_status?r("el-tag",{attrs:{type:"warning"}},[e._v("已取消")]):e._e(),4==t.row.order_status?r("el-tag",{attrs:{type:"info"}},[e._v("司机到达现场")]):e._e(),3==t.row.order_status?r("el-tag",{attrs:{type:"info"}},[e._v("待司机出发")]):e._e(),5==t.row.order_status?r("el-tag",{attrs:{type:"info"}},[e._v("司机运输中")]):e._e(),6==t.row.order_status?r("el-tag",{attrs:{type:"sucess"}},[e._v("已完成")]):e._e()]}}])}),r("el-table-column",{attrs:{label:"二级指派",align:"center","min-width":"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",[e._v(e._s(t.row.third_name))])]}}])}),r("el-table-column",{attrs:{label:"下单时间",align:"center","min-width":"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",[e._v(e._s(e._f("parseTime")(t.row.order_created_time,"{y}-{m}-{d} {h}:{i}")))])]}}])}),r("el-table-column",{attrs:{label:"操作",align:"center","class-name":"small-padding fixed-width",width:"300",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[0==i.order_status?r("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["1","2"],expression:"['1', '2']"}],attrs:{plain:"",size:"mini",type:"danger"},on:{click:function(t){return e.cancelOrder(i)}}},[e._v("取消订单")]):e._e(),1==i.order_status&&i.order_third_id==e.third?r("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["1","2","3"],expression:"['1', '2', '3']"}],attrs:{plain:"",size:"mini"},on:{click:function(t){return e.showDriverDialog(i)}}},[e._v("指派司机")]):e._e(),1==i.order_status&&0==i.order_third_id?r("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["1","2"],expression:"['1', '2']"}],attrs:{plain:"",size:"mini",type:"info"},on:{click:function(t){return e.showDriverLeaderDialog(i)}}},[e._v("指派车队长")]):e._e(),1==i.order_type&&null==i.order_price?r("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["1","2"],expression:"['1', '2']"}],attrs:{plain:"",size:"mini",type:"danger"},on:{click:function(t){return e.assignPriceDialog(i)}}},[e._v("确定价格")]):e._e(),0==i.order_type&&0==i.order_gap_price&&4==i.order_status?r("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["1","2"],expression:"['1', '2']"}],attrs:{plain:"",size:"mini",type:"danger"},on:{click:function(t){return e.assignPriceDialog(i)}}},[e._v("调整差价")]):e._e()]}}])})],1),e._m(0),r("el-dialog",{attrs:{title:"请选择指派的司机",visible:e.driverVisible,width:"20%"},on:{"update:visible":function(t){e.driverVisible=t}}},[r("el-form",{ref:"form",attrs:{model:e.form,"label-width":"80px"}},[r("el-form-item",{attrs:{label:"选择司机"}},[r("el-select",{attrs:{clearable:"",filterable:"",placeholder:"请选择"},model:{value:e.temp.driver_id,callback:function(t){e.$set(e.temp,"driver_id",t)},expression:"temp.driver_id"}},e._l(e.driverTable,(function(e){return r("el-option",{key:e.driver_id,attrs:{label:e.driver_name,value:e.driver_id}})})),1)],1)],1),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.driverVisible=!1}}},[e._v("取 消")]),r("el-button",{attrs:{type:"primary"},on:{click:e.assignDriver}},[e._v("确 定")])],1)],1),r("el-dialog",{attrs:{title:"订单价格",visible:e.priceVisible,width:"20%"},on:{"update:visible":function(t){e.priceVisible=t}}},[r("el-input",{attrs:{placeholder:"请输入价格",type:"Number"},model:{value:e.assignInfo.assignPrice,callback:function(t){e.$set(e.assignInfo,"assignPrice",t)},expression:"assignInfo.assignPrice"}}),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.priceVisible=!1}}},[e._v("取 消")]),r("el-button",{attrs:{type:"primary"},on:{click:e.assignPrice}},[e._v("确 定")])],1)],1),r("el-dialog",{attrs:{title:"请选择车队长",visible:e.driverLeaderVisible,width:"20%"},on:{"update:visible":function(t){e.driverLeaderVisible=t}}},[r("el-form",{ref:"form",attrs:{model:e.form,"label-width":"100px"}},[r("el-form-item",{attrs:{label:"选择车队长"}},[r("el-select",{attrs:{clearable:"",filterable:"",placeholder:"请选择"},model:{value:e.third_temp.third_id,callback:function(t){e.$set(e.third_temp,"third_id",t)},expression:"third_temp.third_id"}},e._l(e.thirdTable,(function(e){return r("el-option",{key:e.dthird_id,attrs:{label:e.third_name,value:e.third_id}})})),1)],1)],1),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.driverLeaderVisible=!1}}},[e._v("取 消")]),r("el-button",{attrs:{type:"primary"},on:{click:e.assignDriverLeader}},[e._v("确 定")])],1)],1)],1)},a=[function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"tip"},[r("h3",{staticStyle:{color:"red"}},[e._v("注意：")]),r("ul",[r("li",[e._v(" 调整差价：该操纵仅能操作普通装修的订单，且只有当司机到达现场确定后才能进行价格调整，每个订单只能调整一次差价； ")]),r("li",[e._v(" 确定价格：该操作仅对商业装修的订单有效，且每个订单只能进行一次价格确定； ")]),r("li",[e._v(" 取消订单：取消订单对所有类型的未支付订单有效，订单取消后将无法进行恢复和支付。 ")])])])}],n=r("5530"),s=r("3a10"),o=r("6329"),l=(r("ed08"),r("2f62")),c={driverId:null,orderNumber:null},d={data:function(){return{list:[],listLoading:!1,total:103,limit:10,page:1,keyword:"",form:c,carRadio:"",driverRadio:"",driverTable:[],thirdTable:[],selectedDriver:"",carTable:[],driverVisible:!1,driverLeaderVisible:!1,dialogFormVisible:!1,priceVisible:!1,temp:{order_id:"",driver_id:""},third_temp:{order_id:"",third_id:""},assignInfo:{orderId:null,orderType:null,assignPrice:null},imageUrl:"",typeList:null,listQuery:{limit:10,offset:0,status:void 0,keyword:""}}},computed:Object(n["a"])({},Object(l["b"])(["roles","third"])),created:function(){this.fetchData()},watch:{driverVisible:{handler:function(e,t){e&&this.fetchDriverList()}},driverLeaderVisible:{handler:function(e,t){e&&this.fetchDriverLeaderList()}}},methods:{fetchData:function(){var e=this;this.list=[],this.listQuery.limit=this.limit,this.listQuery.offset=(this.page-1)*this.limit,this.listLoading=!0,this.listQuery.third_id=this.third,Object(s["d"])(this.listQuery).then((function(t){e.list=t.data,e.listLoading=!1}))},fetchDriverList:function(){var e=this;Object(s["e"])({third:this.third}).then((function(t){e.driverTable=t.data}))},fetchDriverLeaderList:function(){var e=this;Object(o["c"])().then((function(t){e.thirdTable=t.data}))},cancelOrder:function(e){var t=this;this.$confirm("此操作将永久取消订单, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(s["c"])({order_id:e.order_id}).then((function(e){t.$message({type:"success",message:"取消成功!"}),t.fetchData()}))})).catch((function(){t.$message({type:"info",message:"已取消操作"})}))},showDriverDialog:function(e){this.driverVisible=!0,this.temp.order_id=e.order_id},showDriverLeaderDialog:function(e){this.driverLeaderVisible=!0,this.third_temp.order_id=e.order_id},assignDriver:function(){var e=this;""!=this.temp.driver_id?Object(s["a"])(this.temp).then((function(t){e.driverVisible=!1,e.$message({message:"订单指派司机成功！",type:"success"}),e.fetchData()})):this.$message({message:"请先选择司机和车辆",type:"error"})},assignDriverLeader:function(){var e=this;""!=this.third_temp.driver_id?Object(o["g"])(this.third_temp).then((function(t){e.driverLeaderVisible=!1,e.$message({message:"订单分派成功！",type:"success"}),e.fetchData()})):this.$message({message:"请先选择车队",type:"error"})},assignPriceDialog:function(e){this.priceVisible=!0,this.assignInfo.orderId=e.order_id,this.assignInfo.orderType=e.order_type},assignPrice:function(){var e=this;Object(s["b"])(this.assignInfo).then((function(t){e.priceVisible=!1,e.$message({message:t.message,type:"success"}),e.fetchData()}))}}},u=(r("56b3"),d),f=u,_=(r("6c7a"),r("2877")),p=Object(_["a"])(f,i,a,!1,null,"f9c54f1a",null);t["default"]=p.exports},"3a10":function(e,t,r){"use strict";r.d(t,"d",(function(){return n})),r.d(t,"e",(function(){return s})),r.d(t,"c",(function(){return o})),r.d(t,"a",(function(){return l})),r.d(t,"b",(function(){return c})),r.d(t,"f",(function(){return d})),r.d(t,"g",(function(){return u}));var i=r("b775"),a=r("a078");function n(e){return Object(i["a"])({url:"".concat(a["base_path"],"operatedOrder/order/query"),method:"get",params:e})}function s(e){return Object(i["a"])({url:"".concat(a["base_path"],"operatedOrder/driver/query"),method:"get",params:e})}function o(e){return Object(i["a"])({url:"".concat(a["base_path"],"operatedOrder/order/cancel"),method:"get",params:e})}function l(e){return Object(i["a"])({url:"".concat(a["base_path"],"operatedOrder/order/assign"),method:"get",params:e})}function c(e){return Object(i["a"])({url:"".concat(a["base_path"],"order/assignprice"),method:"post",data:e})}function d(e){return Object(i["a"])({url:"".concat(a["base_path"],"order/query/all"),method:"get",params:e})}function u(e){return Object(i["a"])({url:"".concat(a["base_path"],"order/query/detail"),method:"get",params:e})}},6074:function(e,t,r){},6329:function(e,t,r){"use strict";r.d(t,"d",(function(){return n})),r.d(t,"c",(function(){return s})),r.d(t,"g",(function(){return o})),r.d(t,"a",(function(){return l})),r.d(t,"b",(function(){return c})),r.d(t,"e",(function(){return d})),r.d(t,"f",(function(){return u}));var i=r("b775"),a=r("a078");function n(e){return Object(i["a"])({url:"".concat(a["base_path"],"driver/query/all"),method:"get",params:e})}function s(){return Object(i["a"])({url:"".concat(a["base_path"],"driver/query/third"),method:"get"})}function o(e){return Object(i["a"])({url:"".concat(a["base_path"],"driver/update/third"),method:"get",params:e})}function l(e){return Object(i["a"])({url:"".concat(a["base_path"],"car/query/all"),method:"get",params:e})}function c(e){return Object(i["a"])({url:"".concat(a["base_path"],"car/query/queryByKeyword"),method:"get",params:e})}function d(e){return Object(i["a"])({url:"".concat(a["base_path"],"driver/query/queryByKeyword"),method:"get",params:e})}function u(){return Object(i["a"])({url:"".concat(a["base_path"],"ongoing/driver"),method:"get"})}},"6c7a":function(e,t,r){"use strict";var i=r("6074"),a=r.n(i);a.a}}]);